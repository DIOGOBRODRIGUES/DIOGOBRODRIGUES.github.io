<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8">
  <title>Aula 4 - Consumo de APIs em React Native</title>

  <meta name="description" content="Como consumir APIs RESTful com Fetch e Axios em aplica√ß√µes React Native">
  <meta name="author" content="Prof. Dr. Diogo Francisco Borba Rodrigues">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="../../../reveal.js-master/dist/reset.css">
  <link rel="stylesheet" href="../../../reveal.js-master/dist/reveal.css">
  <link rel="stylesheet" href="../../../reveal.js-master/dist/theme/dracula.css" id="theme">

  <!-- Syntax Highlighting -->
  <link rel="stylesheet" href="../../../reveal.js-master/plugin/highlight/monokai.css">

  <style>
    .container {
      display: flex;
      justify-content: space-between;
    }
    .column {
      width: 48%;
    }
    .highlight {
      color: #50fa7b;
      font-weight: bold;
    }
    .warning {
      color: #ffb86c;
      font-weight: bold;
    }
    .important {
      color: #ff79c6;
      font-weight: bold;
    }
    .exercise {
      background-color: rgba(80, 250, 123, 0.2);
      border-left: 4px solid #50fa7b;
      padding: 10px;
      border-radius: 5px;
    }
    .code-small code {
      font-size: 0.7em !important;
      line-height: 1.2em !important;
    }
    .comparison-table {
      border-collapse: collapse;
      width: 100%;
    }
    .comparison-table th, .comparison-table td {
      border:, 1px solid #444;
      padding: 8px;
      text-align: left;
    }
    .comparison-table th {
      background-color: #282a36;
    }
    .http-get { color: #8be9fd; }     /* Cyan */
    .http-post { color: #50fa7b; }    /* Green */
    .http-put { color: #f1fa8c; }     /* Yellow */
    .http-delete { color: #ff79c6; }  /* Pink */
  </style>

</head>

<body>

  <div class="reveal">
    <div class="slides">
      <!-- Slide 1 - T√≠tulo da Aula -->
      <section>
        <p>üèõÔ∏è Centro Universit√°rio Maur√≠cio de Nassau</p>
        <h3>Aula 4 - Consumo de APIs em React Native</h3>
        <p>Prof. Dr. Diogo Francisco Borba Rodrigues</p>
        <a href="https://www.linkedin.com/in/diogo-francisco-borba-rodrigues-3a1b5179/" target="_blank">
          <i class="fab fa-linkedin"></i>
        </a>
        <a href="https://github.com/DIOGOBRODRIGUES" target="_blank">
          <i class="fab fa-github"></i>
        </a>
      </section>

      <!-- Slide 2 - Objetivos da Aula -->
      <section>
        <h3>üéØ Objetivos da Aula</h3>
        <ul>
          <li>Compreender o que s√£o APIs e sua import√¢ncia</li>
          <li>Aprender a consumir APIs RESTful em React Native</li>
          <li>Dominar o uso do Fetch API e Axios</li>
          <li>Implementar FlatList para exibir dados das APIs</li>
          <li>Gerenciar estados de carregamento e erros</li>
          <li>Criar componentes reutiliz√°veis para dados de API</li>
        </ul>
      </section>

      <!-- Slide 3 - Introdu√ß√£o -->
      <section>
        <h3>üì± O que s√£o APIs?</h3>
        <div>
          <p><span class="highlight">API</span> = <span class="important">A</span>pplication <span class="important">P</span>rogramming <span class="important">I</span>nterface</p>
          <p>Uma <span class="highlight">interface</span> que permite que diferentes softwares <span class="highlight">se comuniquem</span> entre si.</p>
          <img src="https://miro.medium.com/max/1400/1*LjkiUO0CsDRK8TBjcI1sTQ.png" alt="Conceito de API" style="width:60%; height:auto; border:none; box-shadow:none; background:none;">
          <p>Em React Native, as APIs nos permitem interagir com servi√ßos web e obter dados din√¢micos.</p>
        </div>
      </section>

      <!-- Slide 4 - Motiva√ß√£o -->
      <section>
        <h3>üí° Por que consumir APIs?</h3>
        <div class="container">
          <div class="column">
            <p><i class="fas fa-server"></i> <span class="highlight">Separa√ß√£o de responsabilidades</span></p>
            <p>O backend gerencia os dados, o frontend apenas os exibe</p>
            <p><i class="fas fa-sync-alt"></i> <span class="highlight">Dados atualizados</span></p>
            <p>Acesso √†s informa√ß√µes mais recentes a qualquer momento</p>
            <p><i class="fas fa-database"></i> <span class="highlight">Redu√ß√£o de armazenamento local</span></p>
            <p>Dados ficam na nuvem, n√£o no dispositivo do usu√°rio</p>
          </div>
          <div class="column">
            <p><i class="fas fa-shield-alt"></i> <span class="highlight">Seguran√ßa</span></p>
            <p>L√≥gica sens√≠vel fica protegida no servidor</p>
            <p><i class="fas fa-code-branch"></i> <span class="highlight">Escalabilidade</span></p>
            <p>Backend e frontend podem escalar independentemente</p>
            <p><i class="fas fa-random"></i> <span class="highlight">Reutiliza√ß√£o</span></p>
            <p>Mesma API pode servir v√°rios clientes (web, mobile, desktop)</p>
          </div>
        </div>
      </section>

      <!-- Slide 5 - APIs RESTful -->
      <section>
        <h3>üåê APIs RESTful</h3>
        <p><span class="highlight">REST</span> = <span class="important">RE</span>presentational <span class="important">S</span>tate <span class="important">T</span>ransfer</p>
        <div class="container">
          <div class="column">
            <h4>Caracter√≠sticas:</h4>
            <ul>
              <li>Baseada em recursos (URLs)</li>
              <li>Opera√ß√µes atrav√©s de m√©todos HTTP</li>
              <li>Stateless (sem estado)</li>
              <li>Interface uniforme</li>
              <li>Comunica√ß√£o cliente-servidor</li>
            </ul>
          </div>
          <div class="column">
            <h4>M√©todos HTTP principais:</h4>
            <ul>
              <li><span class="http-get">GET</span>: Recuperar dados</li>
              <li><span class="http-post">POST</span>: Criar novos recursos</li>
              <li><span class="http-put">PUT/PATCH</span>: Atualizar recursos</li>
              <li><span class="http-delete">DELETE</span>: Remover recursos</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Slide 6 - Formatos de Resposta -->
      <section>
        <h3>üìÑ Formatos de Resposta</h3>
        <div class="container">
          <div class="column">
            <h4>JSON (JavaScript Object Notation)</h4>
            <pre><code data-trim data-noescape data-line-numbers class="language-json">
              {
                "id": 1,
                "name": "John Doe",
                "email": "john@example.com",
                "active": true,
                "roles": ["user", "admin"],
                "address": {
                  "street": "Main St",
                  "city": "Boston"
                }
              }
            </code></pre>
          </div>
          <div class="column">
            <h4>XML (menos comum hoje)</h4>
            <pre><code data-trim data-noescape data-line-numbers class="language-xml">
              &lt;user&gt;
                &lt;id&gt;1&lt;/id&gt;
                &lt;name&gt;John Doe&lt;/name&gt;
                &lt;email&gt;john@example.com&lt;/email&gt;
                &lt;active&gt;true&lt;/active&gt;
                &lt;roles&gt;
                  &lt;role&gt;user&lt;/role&gt;
                  &lt;role&gt;admin&lt;/role&gt;
                &lt;/roles&gt;
              &lt;/user&gt;
            </code></pre>
          </div>
        </div>
        <p>No React Native, trabalhamos principalmente com <span class="highlight">JSON</span>.</p>
      </section>

      <!-- Slide 7 - Status HTTP -->
      <section>
        <h3>üî¢ Status HTTP</h3>
        <div class="container">
          <div class="column">
            <h4>Sucesso (2xx)</h4>
            <ul>
              <li><span class="highlight">200</span>: OK</li>
              <li><span class="highlight">201</span>: Created</li>
              <li><span class="highlight">204</span>: No Content</li>
            </ul>
            <h4>Erro do Cliente (4xx)</h4>
            <ul>
              <li><span class="warning">400</span>: Bad Request</li>
              <li><span class="warning">401</span>: Unauthorized</li>
              <li><span class="warning">403</span>: Forbidden</li>
              <li><span class="warning">404</span>: Not Found</li>
            </ul>
          </div>
          <div class="column">
            <h4>Redirecionamento (3xx)</h4>
            <ul>
              <li>301: Moved Permanently</li>
              <li>302: Found</li>
            </ul>
            <h4>Erro do Servidor (5xx)</h4>
            <ul>
              <li><span class="important">500</span>: Internal Server Error</li>
              <li><span class="important">502</span>: Bad Gateway</li>
              <li><span class="important">503</span>: Service Unavailable</li>
            </ul>
            <p class="warning">Importante tratar os erros no app!</p>
          </div>
        </div>
      </section>

      <!-- Slide 8 - Consumindo APIs no React Native -->
      <section>
        <h3>üõ†Ô∏è Consumindo APIs no React Native</h3>
        <p>Duas abordagens principais:</p>
        <div class="container">
          <div class="column">
            <div style="text-align:center;">
              <h4><i class="fas fa-box"></i> Fetch API</h4>
              <p>Nativa do JavaScript</p>
              <p>Simples e direta</p>
              <p>N√£o precisa de instala√ß√£o</p>
            </div>
          </div>
          <div class="column">
            <div style="text-align:center;">
              <h4><i class="fas fa-rocket"></i> Axios</h4>
              <p>Biblioteca externa</p>
              <p>Mais recursos</p>
              <p>Precisa ser instalada:<br><code>npm install axios</code></p>
            </div>
          </div>
        </div>
      </section>

      <!-- Slide 9 - Fetch API - Uso B√°sico -->
      <section>
        <h3>üì¶ Fetch API - Uso B√°sico</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-5|7-11|13-23" class="language-javascript">
            // Estrutura b√°sica
            fetch(url, options)
              .then(response => response.json())
              .then(data => console.log(data))
              .catch(error => console.error('Error:', error));
            
            // Exemplo GET simples
            fetch('https://api.example.com/users')
              .then(response => response.json())
              .then(users => setUsers(users))
              .catch(error => console.error('Error:', error));
            
            // Usando async/await (mais limpo)
            const fetchUsers = async () => {
              try {
                const response = await fetch('https://api.example.com/users');
                
                if (!response.ok) {
                  throw new Error('Erro na resposta: ' + response.status);
                }
                
                const data = await response.json();
                setUsers(data);
              } catch (error) {
                console.error('Erro ao buscar usu√°rios:', error);
                setError(error.message);
              } finally {
                setLoading(false);
              }
            };
          </code></pre>
        </div>
      </section>

      <!-- Slide 10 - Fetch API - M√©todos HTTP -->
      <section>
        <h3>üì¶ Fetch API - Outros m√©todos HTTP</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-14|16-29|31-43" class="language-javascript">
            // POST - Criar um novo recurso
            const createUser = async (userData) => {
              try {
                const response = await fetch('https://api.example.com/users', {
                  method: 'POST', // Especifica o m√©todo
                  headers: {
                    'Content-Type': 'application/json', // Importante definir o formato
                  },
                  body: JSON.stringify(userData), // Converte objeto JS para JSON
                });
                return await response.json();
              } catch (error) {
                console.error('Error:', error);
              }
            };
            
            // PUT - Atualizar um recurso existente
            const updateUser = async (userId, userData) => {
              try {
                const response = await fetch(`https://api.example.com/users/${userId}`, {
                  method: 'PUT',
                  headers: {
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(userData),
                });
                return await response.json();
              } catch (error) {
                console.error('Error:', error);
              }
            };
            
            // DELETE - Remover um recurso
            const deleteUser = async (userId) => {
              try {
                const response = await fetch(`https://api.example.com/users/${userId}`, {
                  method: 'DELETE',
                  headers: {
                    'Content-Type': 'application/json',
                  },
                });
                // Muitas APIs de exclus√£o retornam 204 No Content
                return response.status === 204 || response.ok;
              } catch (error) {
                console.error('Error:', error);
                return false;
              }
            };
          </code></pre>
        </div>
      </section>

      <!-- Slide 11 - Headers e Autoriza√ß√£o -->
      <section>
        <h3>üîê Headers e Autoriza√ß√£o</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-14|16-29" class="language-javascript">
            // Enviando cabe√ßalhos personalizados
            const fetchWithHeaders = async () => {
              try {
                const response = await fetch('https://api.example.com/data', {
                  headers: {
                    'Content-Type': 'application/json',
                    'Accept-Language': 'pt-BR',
                    'X-API-Key': 'sua_chave_api_aqui',
                    'User-Agent': 'MinhaApp/1.0',
                  }
                });
                return await response.json();
              } catch (error) {
                console.error('Error:', error);
              }
            };
            
            // Autentica√ß√£o com token JWT ou Bearer
            const fetchWithAuth = async () => {
              // Recupera token do armazenamento (ex: AsyncStorage)
              const token = await AsyncStorage.getItem('userToken');
              
              try {
                const response = await fetch('https://api.example.com/protected-resource', {
                  headers: {
                    'Authorization': `Bearer ${token}`, // Padr√£o comum de autentica√ß√£o
                    'Content-Type': 'application/json',
                  }
                });
                return await response.json();
              } catch (error) {
                // Se o erro for 401, pode significar que o token expirou
                if (error.response && error.response.status === 401) {
                  // L√≥gica para renovar token ou fazer logout
                }
                console.error('Error:', error);
              }
            };
          </code></pre>
        </div>
      </section>

      <!-- Slide 12 - Axios - Instala√ß√£o e Uso B√°sico -->
      <section>
        <h3>üöÄ Axios - Instala√ß√£o e Uso B√°sico</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-2|4-10|12-26" class="language-javascript">
            // Instala√ß√£o
            // npm install axios
            
            // Importa√ß√£o e uso b√°sico
            import axios from 'axios';
            
            // GET Request
            axios.get('https://api.example.com/users')
              .then(response => console.log(response.data))
              .catch(error => console.error(error));
            
            // Usando async/await com Axios
            const fetchUsers = async () => {
              try {
                const response = await axios.get('https://api.example.com/users');
                // Axios j√° d√° a resposta em .data (n√£o precisa chamar .json())
                console.log(response.data);
                setUsers(response.data);
                setLoading(false);
              } catch (error) {
                console.error('Erro ao buscar usu√°rios:', error);
                
                // Axios fornece acesso f√°cil aos detalhes do erro
                if (error.response) {
                  // O servidor respondeu com um status diferente de 2xx
                  setError(`Erro ${error.response.status}: ${error.response.data.message || 'Desconhecido'}`);
                } else if (error.request) {
                  // A requisi√ß√£o foi feita mas n√£o houve resposta
                  setError('Servidor n√£o respondeu. Verifique sua conex√£o.');
                } else {
                  // Erro na configura√ß√£o da requisi√ß√£o
                  setError('Erro ao configurar requisi√ß√£o: ' + error.message);
                }
                setLoading(false);
              }
            };
          </code></pre>
        </div>
      </section>

      <!-- Slide 13 - Axios - M√©todos HTTP -->
      <section>
        <h3>üöÄ Axios - Outros m√©todos HTTP</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-9|11-19|21-29" class="language-javascript">
            // POST com Axios
            const createUser = async (userData) => {
              try {
                const response = await axios.post('https://api.example.com/users', userData);
                console.log('Usu√°rio criado:', response.data);
                return response.data;
              } catch (error) {
                console.error('Erro ao criar usu√°rio:', error);
              }
            };
            
            // PUT com Axios
            const updateUser = async (userId, userData) => {
              try {
                const response = await axios.put(`https://api.example.com/users/${userId}`, userData);
                console.log('Usu√°rio atualizado:', response.data);
                return response.data;
              } catch (error) {
                console.error('Erro ao atualizar usu√°rio:', error);
              }
            };
            
            // DELETE com Axios
            const deleteUser = async (userId) => {
              try {
                const response = await axios.delete(`https://api.example.com/users/${userId}`);
                console.log('Usu√°rio deletado');
                return true;
              } catch (error) {
                console.error('Erro ao deletar usu√°rio:', error);
                return false;
              }
            };
          </code></pre>
        </div>
      </section>

      <!-- Slide 14 - Configura√ß√£o do Axios -->
      <section>
        <h3>üöÄ Configura√ß√£o do Axios</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-15|17-28|30-45" class="language-javascript">
            // Criando uma inst√¢ncia com configura√ß√£o padr√£o
            import axios from 'axios';
            
            // Configura√ß√£o b√°sica
            const api = axios.create({
              baseURL: 'https://api.example.com', // URL base para todas as requisi√ß√µes
              timeout: 10000, // Tempo m√°ximo de espera (10 segundos)
              headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
              }
            });
            
            // Uso da inst√¢ncia
            await api.get('/users'); // GET https://api.example.com/users
            await api.post('/products', newProduct); // POST https://api.example.com/products
            
            // Interceptadores de requisi√ß√£o
            api.interceptors.request.use(
              (config) => {
                // Manipule a config antes do envio
                console.log('Enviando requisi√ß√£o:', config.url);
                
                // Adicionar token de autentica√ß√£o dinamicamente
                const token = AsyncStorage.getItem('userToken');
                if (token) {
                  config.headers.Authorization = `Bearer ${token}`;
                }
                
                return config;
              },
              (error) => {
                return Promise.reject(error);
              }
            );
            
            // Interceptadores de resposta
            api.interceptors.response.use(
              (response) => {
                // Qualquer c√≥digo de status entre 200 e 299 aciona esta fun√ß√£o
                console.log('Resposta recebida:', response.status);
                return response;
              },
              (error) => {
                // Qualquer c√≥digo fora da faixa 2xx aciona esta fun√ß√£o
                if (error.response && error.response.status === 401) {
                  // Token expirado ou inv√°lido - fazer logout ou renovar token
                  console.log('Usu√°rio n√£o autenticado');
                  // logout();
                }
                
                return Promise.reject(error);
              }
            );
          </code></pre>
        </div>
      </section>

      <!-- Slide 15 - Compara√ß√£o: Fetch vs Axios -->
      <section>
        <h3>‚öñÔ∏è Fetch vs Axios: Compara√ß√£o</h3>
        <table class="comparison-table">
          <tr>
            <th>Caracter√≠stica</th>
            <th>Fetch API</th>
            <th>Axios</th>
          </tr>
          <tr>
            <td>Instala√ß√£o</td>
            <td>Nativa (sem instala√ß√£o)</td>
            <td>Requer instala√ß√£o</td>
          </tr>
          <tr>
            <td>Sintaxe</td>
            <td>Mais verbosa</td>
            <td>Mais concisa</td>
          </tr>
          <tr>
            <td>Transforma√ß√£o de resposta</td>
            <td>Manual (.json())</td>
            <td>Autom√°tica (.data)</td>
          </tr>
          <tr>
            <td>Tratamento de erros</td>
            <td>B√°sico</td>
            <td>Robusto</td>
          </tr>
          <tr>
            <td>Interceptadores</td>
            <td>N√£o possui</td>
            <td>Possui</td>
          </tr>
          <tr>
            <td>Cancelamento</td>
            <td>Complexo</td>
            <td>Simples</td>
          </tr>
          <tr>
            <td>Suporte a navegadores</td>
            <td>Mais recentes</td>
            <td>Maior compatibilidade</td>
          </tr>
        </table>
        <p><span class="important">Escolha baseada nas necessidades do seu projeto!</span></p>
      </section>

      <!-- Slide 16 - FlatList - Introdu√ß√£o -->
      <section>
        <h3>üìã FlatList - Introdu√ß√£o</h3>
        <div class="container">
          <div class="column">
            <p>Componente para renderizar listas eficientes em React Native</p>
            <ul>
              <li><span class="highlight">Virtualiza√ß√£o</span>: renderiza apenas os itens vis√≠veis</li>
              <li><span class="highlight">Alto desempenho</span>: ideal para listas longas</li>
              <li><span class="highlight">Pull-to-refresh</span>: atualiza√ß√£o por gesto</li>
              <li><span class="highlight">Carregamento paginado</span>: lazy loading</li>
              <li><span class="highlight">Otimizado</span>: reciclagem de c√©lulas</li>
            </ul>
          </div>
          <div class="column">
            <pre><code data-trim data-noescape data-line-numbers class="language-javascript">
              import { FlatList, Text, View } from 'react-native';
              
              const DATA = [
                { id: '1', title: 'Item 1' },
                { id: '2', title: 'Item 2' },
                { id: '3', title: 'Item 3' },
                // ... mais itens
              ];
              
              export default function App() {
                return (
                  <FlatList
                    data={DATA}
                    keyExtractor={(item) => item.id}
                    renderItem={({ item }) => (
                      <Text>{item.title}</Text>
                    )}
                  />
                );
              }
            </code></pre>
          </div>
        </div>
      </section>

      <!-- Slide 17 - FlatList - Propriedades Principais -->
      <section>
        <h3>üìã FlatList - Propriedades Principais</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-12|13-16|17-20|21-26|27-32|33-36" class="language-javascript">
            <FlatList
              // Dados que ser√£o renderizados
              data={items}
              
              // Como renderizar cada item
              renderItem={({ item, index }) => (
                <ItemComponent 
                  item={item} 
                  index={index} 
                />
              )}
              
              // Fun√ß√£o para extrair uma chave √∫nica para cada item
              keyExtractor={(item) => item.id.toString()}
              
              // Componente exibido quando a lista est√° vazia
              ListEmptyComponent={<Text>Nenhum item encontrado.</Text>}
              
              // Cabe√ßalho e rodap√© da lista
              ListHeaderComponent={<Text style={styles.header}>Minha Lista</Text>}
              ListFooterComponent={<Text style={styles.footer}>Fim da lista</Text>}
              
              // Estiliza√ß√£o
              contentContainerStyle={styles.listContainer}
              columnWrapperStyle={styles.row} // Apenas para numColumns > 1
              
              // M√∫ltiplas colunas (grid)
              numColumns={2}
              
              // Separador entre itens
              ItemSeparatorComponent={() => (
                <View style={{ height: 1, backgroundColor: '#ddd' }} />
              )}
              
              // Pull-to-refresh
              refreshing={isRefreshing}
              onRefresh={handleRefresh}
              
              // Carregamento infinito / pagina√ß√£o
              onEndReached={loadMoreItems}
              onEndReachedThreshold={0.5} // Carrega quando chegar a 50% do final
            />
          </code></pre>
        </div>
      </section>

      <!-- Slide 18 - FlatList com APIs -->
      <section>
        <h3>üì± FlatList com Dados de API</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-14|16-25|27-43|45-61" class="language-javascript">
            import React, { useState, useEffect } from 'react';
            import { View, Text, FlatList, ActivityIndicator, StyleSheet } from 'react-native';
            import axios from 'axios';
            
            export default function UserList() {
              // Estados para controlar os dados e o estado da UI
              const [users, setUsers] = useState([]);
              const [loading, setLoading] = useState(true);
              const [error, setError] = useState(null);
              const [refreshing, setRefreshing] = useState(false);
              
              // Fun√ß√£o para buscar os dados
              const fetchUsers = async () => {
                setLoading(true);
                setError(null);
                
                try {
                  // Usando uma API p√∫blica para exemplo
                  const response = await axios.get('https://jsonplaceholder.typicode.com/users');
                  setUsers(response.data);
                } catch (error) {
                  console.error('Erro ao buscar usu√°rios:', error);
                  setError('N√£o foi poss√≠vel carregar os usu√°rios. Tente novamente.');
                } finally {
                  setLoading(false);
                  setRefreshing(false);
                }
              };
              
              // Fun√ß√£o de atualizar puxando para baixo
              const handleRefresh = () => {
                setRefreshing(true);
                fetchUsers();
              };
              
              // Carregar dados quando o componente montar
              useEffect(() => {
                fetchUsers();
              }, []);
              
              // Renderiza cada item da lista
              const renderItem = ({ item }) => (
                <View style={styles.item}>
                  <Text style={styles.name}>{item.name}</Text>
                  <Text style={styles.email}>{item.email}</Text>
                  <Text style={styles.company}>{item.company.name}</Text>
                </View>
              );
              
              // Componente para exibir quando h√° erro
              const renderError = () => (
                <View style={styles.centered}>
                  <Text style={styles.errorText}>{error}</Text>
                  <TouchableOpacity 
                    style={styles.retryButton} 
                    onPress={fetchUsers}
                  >
                    <Text style={styles.retryText}>Tentar novamente</Text>
                  </TouchableOpacity>
                </View>
              );
              
              // Componente para exibir durante o carregamento
              const renderLoading = () => (
                <View style={styles.centered}>
                  <ActivityIndicator size="large" color="#0066cc" />
                  <Text style={styles.loadingText}>Carregando usu√°rios...</Text>
                </View>
              );
              
              // Se estiver no estado inicial de carregamento, mostra o indicador
              if (loading && !refreshing) {
                return renderLoading();
              }
              
              // Se houver erro e n√£o estiver atualizando, mostra o erro
              if (error && !refreshing) {
                return renderError();
              }
              
              // Renderiza a lista principal
              return (
                <FlatList
                  data={users}
                  renderItem={renderItem}
                  keyExtractor={(item) => item.id.toString()}
                  refreshing={refreshing}
                  onRefresh={handleRefresh}
                  ListHeaderComponent={<Text style={styles.header}>Usu√°rios</Text>}
                  ListEmptyComponent={
                    !loading && !error ? 
                    <Text style={styles.emptyText}>Nenhum usu√°rio encontrado</Text> : 
                    null
                  }
                  contentContainerStyle={styles.list}
                  ItemSeparatorComponent={() => <View style={styles.separator} />}
                />
              );
            }
            
            const styles = StyleSheet.create({
              centered: {
                flex: 1,
                justifyContent: 'center',
                alignItems: 'center',
                padding: 20,
              },
              list: {
                padding: 16,
              },
              item: {
                padding: 15,
                borderRadius: 8,
                backgroundColor: '#f8f8f8',
                marginBottom: 10,
              },
              name: {
                fontSize: 18,
                fontWeight: 'bold',
              },
              email: {
                color: '#666',
                marginTop: 5,
              },
              company: {
                fontStyle: 'italic',
                marginTop: 5,
              },
              header: {
                fontSize: 22,
                fontWeight: 'bold',
                marginBottom: 15,
                textAlign: 'center',
              },
              separator: {
                height: 1,
                backgroundColor: '#eee',
              },
              errorText: {
                color: 'red',
                textAlign: 'center',
                marginBottom: 15,
              },
              loadingText: {
                marginTop: 10,
              },
              emptyText: {
                textAlign: 'center',
                padding: 20,
              },
              retryButton: {
                padding: 10,
                backgroundColor: '#0066cc',
                borderRadius: 5,
              },
              retryText: {
                color: 'white',
                fontWeight: 'bold',
              },
            });
          </code></pre>
        </div>
      </section>

      <!-- Slide 19 - Otimiza√ß√£o de Performance da FlatList -->
      <section>
        <h3>‚ö° Otimiza√ß√£o de Performance da FlatList</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-9|11-17|19-28|30-37" class="language-javascript">
            // 1. Use React.memo para evitar re-renderiza√ß√µes
            const UserItem = React.memo(({ user }) => (
              <View style={styles.item}>
                <Text style={styles.name}>{user.name}</Text>
                <Text style={styles.email}>{user.email}</Text>
              </View>
            ));
            
            <FlatList 
              renderItem={({ item }) => <UserItem user={item} />}
            />
            
            // 2. Implemente getItemLayout para dimens√µes fixas
            <FlatList
              getItemLayout={(data, index) => ({
                length: 80, // altura de cada item
                offset: 80 * index,
                index,
              })}
            />
            
            // 3. Use windowSize para controlar quantos itens s√£o renderizados
            <FlatList
              // Define quantas telas de conte√∫do s√£o renderizadas
              // antes, vis√≠veis e depois da √°rea vis√≠vel
              windowSize={5} // padr√£o √© 21 (10 antes, 1 vis√≠vel, 10 depois)
              
              // Mantenha os itens montados mesmo quando fora da janela
              removeClippedSubviews={true} // pode causar problemas em alguns casos
              
              // N√∫mero de itens para renderizar no lote inicial
              initialNumToRender={10} // padr√£o √© 10
            />
            
            // 4. Otimize a extra√ß√£p da chave
            <FlatList
              // Use keyExtractor em vez de key na renderItem
              keyExtractor={(item) => item.id.toString()}
              
              // OU defina a keyProperty para uso direto
              keyExtractor={null}
              keyProperty="id" // FlatList usar√° item.id como chave
            />
          </code></pre>
        </div>
      </section>

      <!-- Slide 20 - Pagina√ß√£o com FlatList -->
      <section>
        <h3>üìÑ Pagina√ß√£o com FlatList</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-19|21-36|38-53|55-66" class="language-javascript">
            import React, { useState, useEffect } from 'react';
            import { FlatList, ActivityIndicator, Text, View, StyleSheet } from 'react-native';
            import axios from 'axios';
            
            export default function PaginatedList() {
              const [data, setData] = useState([]);
              const [page, setPage] = useState(1);
              const [loading, setLoading] = useState(false);
              const [loadingMore, setLoadingMore] = useState(false);
              const [hasMore, setHasMore] = useState(true);
              const [error, setError] = useState(null);
              const PER_PAGE = 20;
              
              // Fun√ß√£o para carregar a p√°gina inicial
              const loadData = async () => {
                if (loading) return;
                
                setLoading(true);
                setError(null);
                setPage(1);
                
                try {
                  // API de exemplo que suporta pagina√ß√£o
                  const response = await axios.get(`https://api.example.com/items?page=1&per_page=${PER_PAGE}`);
                  
                  setData(response.data.items);
                  setHasMore(response.data.items.length === PER_PAGE);
                } catch (error) {
                  console.error('Erro ao carregar dados:', error);
                  setError('Falha ao carregar dados. Tente novamente.');
                } finally {
                  setLoading(false);
                }
              };
              
              // Fun√ß√£o para carregar a pr√≥xima p√°gina
              const loadMoreData = async () => {
                if (loadingMore || !hasMore || loading) return;
                
                setLoadingMore(true);
                
                try {
                  const nextPage = page + 1;
                  const response = await axios.get(`https://api.example.com/items?page=${nextPage}&per_page=${PER_PAGE}`);
                  
                  const newItems = response.data.items;
                  
                  if (newItems.length > 0) {
                    setData(prevData => [...prevData, ...newItems]);
                    setPage(nextPage);
                    setHasMore(newItems.length === PER_PAGE);
                  } else {
                    setHasMore(false);
                  }
                } catch (error) {
                  console.error('Erro ao carregar mais dados:', error);
                } finally {
                  setLoadingMore(false);
                }
              };
              
              // Carregar dados iniciais
              useEffect(() => {
                loadData();
              }, []);
              
              // Renderiza o rodap√© da lista - indicador de loading ou mensagem final
              const renderFooter = () => {
                if (!hasMore && data.length > 0) {
                  return <Text style={styles.endMessage}>Fim da lista</Text>;
                }
                
                if (loadingMore) {
                  return (
                    <View style={styles.loadingMore}>
                      <ActivityIndicator size="small" color="#0066cc" />
                      <Text style={styles.loadingMoreText}>Carregando mais...</Text>
                    </View>
                  );
                }
                
                return null;
              };
              
              // Renderiza o componente principal
              return (
                <View style={styles.container}>
                  {loading ? (
                    <View style={styles.loading}>
                      <ActivityIndicator size="large" color="#0066cc" />
                      <Text>Carregando dados...</Text>
                    </View>
                  ) : error ? (
                    <View style={styles.error}>
                      <Text style={styles.errorText}>{error}</Text>
                      <TouchableOpacity style={styles.retryButton} onPress={loadData}>
                        <Text style={styles.retryText}>Tentar novamente</Text>
                      </TouchableOpacity>
                    </View>
                  ) : (
                    <FlatList
                      data={data}
                      keyExtractor={(item) => item.id.toString()}
                      renderItem={({ item }) => (
                        <View style={styles.item}>
                          <Text style={styles.title}>{item.title}</Text>
                          <Text>{item.description}</Text>
                        </View>
                      )}
                      onEndReached={loadMoreData} // Chamado quando o usu√°rio chega perto do fim
                      onEndReachedThreshold={0.5} // Carrega mais quando estiver a 50% do final
                      ListFooterComponent={renderFooter}
                      refreshing={loading}
                      onRefresh={loadData} // Pull to refresh
                    />
                  )}
                </View>
              );
            }
            
            const styles = StyleSheet.create({
              container: {
                flex: 1,
              },
              loading: {
                flex: 1,
                justifyContent: 'center',
                alignItems: 'center',
              },
              item: {
                padding: 15,
                borderBottomWidth: 1,
                borderBottomColor: '#eee',
              },
              title: {
                fontSize: 16,
                fontWeight: 'bold',
              },
              loadingMore: {
                flexDirection: 'row',
                justifyContent: 'center',
                alignItems: 'center',
                padding: 10,
              },
              loadingMoreText: {
                marginLeft: 10,
              },
              endMessage: {
                textAlign: 'center',
                padding: 10,
                fontStyle: 'italic',
                color: '#666',
              },
              error: {
                flex: 1,
                justifyContent: 'center',
                alignItems: 'center',
                padding: 20,
              },
              errorText: {
                color: 'red',
                marginBottom: 15,
                textAlign: 'center',
              },
              retryButton: {
                backgroundColor: '#0066cc',
                padding: 10,
                borderRadius: 5,
              },
              retryText: {
                color: 'white',
                fontWeight: 'bold',
              },
            });
          </code></pre>
        </div>
      </section>

      <!-- Slide 21 - Imagens de APIs -->
      <section>
        <h3>üñºÔ∏è Trabalhando com Imagens de APIs</h3>
        <div class="code-small">
          <pre><code data-trim data-noescape data-line-numbers="1-22|24-53" class="language-javascript">
            import React from 'react';
            import { View, Image, Text, StyleSheet, FlatList, ActivityIndicator } from 'react-native';
            
            // Componente de imagem com estado de carregamento
            const ApiImage = ({ uri, style }) => {
              const [loading, setLoading] = React.useState(true);
              const [error, setError] = React.useState(false);
              
              return (
                <View style={[styles.imageContainer, style]}>
                  {loading && (
                    <ActivityIndicator 
                      style={styles.imageLoader} 
                      size="small" 
                      color="#0066cc" 
                    />
                  )}
                  
                  <Image
                    source={{ uri }}
                    style={[styles.image, style]}
                    onLoadStart={() => setLoading(true)}
                    onLoadEnd={() => setLoading(false)}
                    onError={() => {
                      setLoading(false);
                      setError(true);
                    }}
                  />
                  
                  {error && (
                    <View style={[styles.errorOverlay, style]}>
                      <Text style={styles.errorText}>Falha ao carregar imagem</Text>
                    </View>
                  )}
                </View>
              );
            };
            
            // Exemplo de uso em uma lista de produtos
            export default function ProductList() {
              // ... c√≥digo para buscar produtos de uma API
              
              const renderProduct = ({ item }) => (
                <View style={styles.productCard}>
                  <ApiImage
                    uri={item.imageUrl}
                    style={styles.productImage}
                  />
                  <View style={styles.productInfo}>
                    <Text style={styles.productName}>{item.name}</Text>
                    <Text style={styles.productPrice}>R$ {item.price.toFixed(2)}</Text>
                  </View>
                </View>
              );
              
              return (
                <FlatList
                  data={products}
                  keyExtractor={(item) => item.id.toString()}
                  renderItem={renderProduct}
                  numColumns={2}
                  columnWrapperStyle={styles.row}
                  contentContainerStyle={styles.list}
                />
              );
            }
            
            const styles = StyleSheet.create({
              imageContainer: {
                position: 'relative',
                overflow: 'hidden',
              },
              image: {
                width: '100%',
                height: '100%',
                resizeMode: 'cover',
              },
              imageLoader: {
                position: 'absolute',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                justifyContent: 'center',
                alignItems: 'center',
              },
              errorOverlay: {
                position: 'absolute',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.1)',
                justifyContent: 'center',
                alignItems: 'center',
              },
              errorText: {
                color: '#ff0000',
                textAlign: 'center',
                backgroundColor: 'rgba(255,255,255,0.8)',
                padding: 5,
              },
              productCard: {
                flex: 1,
                margin: 8,
                borderRadius: 8,
                backgroundColor: 'white',
                overflow: 'hidden',
                elevation: 2,
                shadowColor: '#000',
                shadowOffset: { width: 0, height: 2 },
                shadowOpacity: 0.1,
                shadowRadius: 4,
              },
              productImage: {
                height: 150,
              },
              productInfo: {
                padding: 8,
              },
              productName: {
                fontSize: 14,
                fontWeight: 'bold',
              },
              productPrice: {
                color: '#0066cc',
                marginTop: 4,
              },
              row: {
                justifyContent: 'space-between',
              },
              list: {
                padding: 8,
              },
            });
          </code></pre>
        </div>
      </section>

      <!-- Slide 22 - Exerc√≠cio em Sala 1 -->
      <section>
        <h3>üíª Exerc√≠cio em Sala 1</h3>
        <div class="exercise">
          <h4>Lista de Usu√°rios com Fetch</h4>
          <p>Crie um aplicativo React Native que:</p>
          <ol>
            <li>Use Fetch API para obter dados de usu√°rios da API JSONPlaceholder</li>
            <li>Exiba os dados em uma FlatList com nome, email e empresa</li>
            <li>Implemente estados de carregamento e erro</li>
            <li>Adicione funcionalidade de pull-to-refresh</li>
          </ol>
          <p>API: <code>https://jsonplaceholder.typicode.com/users</code></p>
          <p><span class="warning">Tempo:</span> 20 minutos</p>
        </div>
      </section>

      <!-- Slide 23 - Exerc√≠cio em Sala 2 -->
      <section>
        <h3>üíª Exerc√≠cio em Sala 2</h3>
        <div class="exercise">
          <h4>Galeria de Fotos com Axios</h4>
          <p>Crie um aplicativo de galeria de fotos que:</p>
          <ol>
            <li>Use Axios para carregar imagens da API JSONPlaceholder Photos</li>
            <li>Exiba as fotos em um grid de 2 colunas usando FlatList</li>
            <li>Implemente pagina√ß√£o (carregamento infinito)</li>
            <li>Adicione um indicador de carregamento de imagem</li>
            <li>Permita clicar em uma foto para ver detalhes</li>
          </ol>
          <p>API: <code>https://jsonplaceholder.typicode.com/photos?_page=1&_limit=20</code></p>
          <p><span class="warning">Tempo:</span> 30 minutos</p>
        </div>
      </section>

      <!-- Slide 24 - Exerc√≠cio para Casa -->
      <section>
        <h3>üè† Exerc√≠cio para Casa</h3>
        <div class="exercise">
          <h4>Aplicativo de Lista de Filmes</h4>
          <p>Desenvolva um aplicativo de filmes utilizando a API TMDB (The Movie Database):</p>
          <ol>
            <li>Crie uma conta gratuita e obtenha uma API Key: <a href="https://developers.themoviedb.org/3/getting-started/introduction">https://developers.themoviedb.org/3/getting-started/introduction</a></li>
            <li>Implemente telas para:
              <ul>
                <li>Lista de filmes populares</li>
                <li>Detalhes do filme selecionado</li>
                <li>Pesquisa de filmes</li>
              </ul>
            </li>
            <li>Use FlatList com optimiza√ß√µes de performance</li>
            <li>Implemente carregamento paginado</li>
            <li>Use Axios para todas as requisi√ß√µes</li>
            <li>Crie componentes reutiliz√°veis para itens de filme</li>
          </ol>
          <p><span class="important">Data de entrega:</span> Pr√≥xima aula</p>
        </div>
      </section>

      <!-- Slide 25 - Dicas e Boas Pr√°ticas -->
      <section>
        <h3>üí° Dicas e Boas Pr√°ticas</h3>
        <div class="container">
          <div class="column">
            <h4>Consumo de APIs:</h4>
            <ul>
              <li>Sempre trate erros de rede</li>
              <li>Implemente timeout para requisi√ß√µes</li>
              <li>Cache respostas frequentes</li>
              <li>Use interceptadores para tokens</li>
              <li>Centralize a l√≥gica de API</li>
            </ul>
          </div>
          <div class="column">
            <h4>FlatList & Performance:</h4>
            <ul>
              <li>Use <code>React.memo</code> para itens da lista</li>
              <li>Defina <code>keyExtractor</code> adequadamente</li>
              <li>Evite fun√ß√µes an√¥nimas em <code>renderItem</code></li>
              <li>Use <code>getItemLayout</code> quando poss√≠vel</li>
              <li>Otimize imagens (tamanho e formato)</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Slide 26 - Refer√™ncias -->
      <section>
        <h3>üìö Refer√™ncias</h3>
        <ul>
          <li><a href="https://reactnative.dev/docs/network">React Native - Networking</a></li>
          <li><a href="https://reactnative.dev/docs/flatlist">React Native - FlatList</a></li>
          <li><a href="https://axios-http.com/docs/intro">Axios Documentation</a></li>
          <li><a href="https://developer.mozilla.org/pt-BR/docs/Web/API/Fetch_API">MDN - Fetch API</a></li>
          <li><a href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a> (API para testes)</li>
          <li><a href="https://github.com/typicode/json-server">JSON Server</a> (API local para desenvolvimento)</li>
          <li><a href="https://www.themoviedb.org/documentation/api">The Movie Database API</a></li>
        </ul>
        <p style="margin-top: 40px; font-size: 0.8em;">Entre em contato para d√∫vidas: ‚úâÔ∏è <a href="mailto:diogo.francisco@sereduc.com">diogo.francisco@sereduc.com</a></p>
      </section>

    </div>
  </div>

  <script src="../../../reveal.js-master/dist/reveal.js"></script>
  <script src="../../../reveal.js-master/plugin/zoom/zoom.js"></script>
  <script src="../../../reveal.js-master/plugin/notes/notes.js"></script>
  <script src="../../../reveal.js-master/plugin/search/search.js"></script>
  <script src="../../../reveal.js-master/plugin/markdown/markdown.js"></script>
  <script src="../../../reveal.js-master/plugin/highlight/highlight.js"></script>
  <script>
    Reveal.initialize({
      controls: true,
      progress: true,
      center: true,
      hash: true,
      slideNumber: true,
      plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight]
    });
  </script>
</body>

</html>
